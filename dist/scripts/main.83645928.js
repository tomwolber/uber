"use strict";var uber=uber||{};uber.vm=new Vue({el:"body",data:{menuVisible:!1,hint:"",term:"",chosen:"",chosenSet:[],masterList:[],titleList:[],locations:[]},computed:{showEmpty:function(){return 0===this.locations.length}},methods:{init:function(){$.get("https://data.sfgov.org/resource/wwmu-gmzc.json",function(a){uber.vm.masterList=a,uber.vm.buildLists()})},buildLists:function(){uber.vm.titleList=_.uniq(uber.vm.masterList,function(a){return a.title}),uber.vm.locations=uber.vm.titleList},toggleMenu:function(){uber.vm.menuVisible=!uber.vm.menuVisible},listFilter:function(a){var b,c,d=a.target.value.toLowerCase();uber.vm.locations=_.filter(uber.vm.titleList,function(a){return a.title.toLowerCase().indexOf(d)>-1}),uber.vm.locations.length>0?(b=uber.vm.locations[0].title,c=b.toLowerCase(),uber.vm.hint=uber.vm.term.length>0&&0===c.indexOf(d)?b:""):uber.vm.hint=""},tabComplete:function(){return uber.vm.term.length>0&&(uber.vm.term=uber.vm.hint,uber.vm.hint="",uber.vm.getLocations(uber.vm.term)),!1},getLocations:function(a){var b;uber.markers.clearLayers(),uber.vm.term=a,uber.vm.chosen=a,a=a.toLowerCase(),b=_.filter(uber.vm.masterList,function(b){return b.title.toLowerCase().indexOf(a)>-1}),uber.vm.fetchMarkers(b)},fetchMarkers:function(a){var b;_.each(a,function(a,c){b=a.coords?0:c,setTimeout(function(){var b;a.locations?(a.locations=a.locations||"",a.fun_facts=a.fun_facts||"",async.series([function(b){a.coords?b(null):$.get("http://maps.google.com/maps/api/geocode/json?sensor=false&address="+a.locations+"san francisco ca").done(function(c){a.coords=c.results[0].geometry.location,b(null)})},function(){b=L.marker([a.coords.lat,a.coords.lng]).bindPopup("<strong>"+a.title+"</strong><br>"+a.locations+"<br>"+a.fun_facts),uber.markers.addLayer(b)}])):alert("Sorry, incomplete data for "+a.title)},500*b)})}}});